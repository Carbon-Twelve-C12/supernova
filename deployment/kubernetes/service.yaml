# Headless Service for StatefulSet DNS resolution
apiVersion: v1
kind: Service
metadata:
  name: supernova-headless
  namespace: supernova-testnet
  labels:
    app.kubernetes.io/name: supernova
    app.kubernetes.io/component: node
spec:
  clusterIP: None
  selector:
    app.kubernetes.io/name: supernova
    app.kubernetes.io/component: node
  ports:
    - name: p2p
      port: 8333
      targetPort: 8333
      protocol: TCP
    - name: rpc
      port: 8332
      targetPort: 8332
      protocol: TCP
    - name: metrics
      port: 9100
      targetPort: 9100
      protocol: TCP
---
# ClusterIP Service for internal RPC access
apiVersion: v1
kind: Service
metadata:
  name: supernova-rpc
  namespace: supernova-testnet
  labels:
    app.kubernetes.io/name: supernova
    app.kubernetes.io/component: rpc
spec:
  type: ClusterIP
  selector:
    app.kubernetes.io/name: supernova
    app.kubernetes.io/component: node
  ports:
    - name: rpc
      port: 8332
      targetPort: 8332
      protocol: TCP
---
# LoadBalancer Service for external P2P access
apiVersion: v1
kind: Service
metadata:
  name: supernova-p2p
  namespace: supernova-testnet
  labels:
    app.kubernetes.io/name: supernova
    app.kubernetes.io/component: p2p
  annotations:
    # Cloud provider specific annotations can be added here
    # service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
spec:
  type: LoadBalancer
  selector:
    app.kubernetes.io/name: supernova
    app.kubernetes.io/component: node
  ports:
    - name: p2p
      port: 8333
      targetPort: 8333
      protocol: TCP
  # externalTrafficPolicy: Local  # For better performance and source IP preservation
---
# NodePort Service for external RPC access (alternative to Ingress)
apiVersion: v1
kind: Service
metadata:
  name: supernova-rpc-external
  namespace: supernova-testnet
  labels:
    app.kubernetes.io/name: supernova
    app.kubernetes.io/component: rpc-external
spec:
  type: NodePort
  selector:
    app.kubernetes.io/name: supernova
    app.kubernetes.io/component: node
  ports:
    - name: rpc
      port: 8332
      targetPort: 8332
      nodePort: 30332  # Fixed NodePort for predictable access
      protocol: TCP

