# Supernova Cargo Deny Configuration
# SECURITY MODULE (P1-006): Comprehensive dependency policy
#
# This file configures cargo-deny to enforce:
# - License compliance
# - Security vulnerability checks
# - Supply chain integrity
#
# Documentation: https://embarkstudios.github.io/cargo-deny/

[graph]
# List of crates to exclude from the dependency graph
exclude = []
# Additional source to include (e.g., private registries)
# all-features = true

# ============================================================================
# ADVISORIES - Security vulnerability checks
# ============================================================================
[advisories]
# The database of vulnerabilities to check against
db-path = "~/.cargo/advisory-db"
# URL to the advisory database
db-urls = ["https://github.com/rustsec/advisory-db"]
# How to handle vulnerabilities
# "deny" = fail the build if any vulnerabilities are found
# "warn" = warn but don't fail
vulnerability = "deny"
# How to handle unmaintained crates
unmaintained = "warn"
# How to handle crates with known yanked versions
yanked = "deny"
# How to handle advisories that don't apply to our platform
notice = "warn"
# List of advisory IDs to ignore
# Only add entries here with documented justification
ignore = [
    # Example: "RUSTSEC-2020-0001", # Reason for ignoring
]

# ============================================================================
# LICENSES - License compliance
# ============================================================================
[licenses]
# What to do when an unlicensed crate is found
unlicensed = "deny"
# How to handle copyleft licenses
copyleft = "warn"
# How to handle missing license files
allow-osi-fsf-free = "either"
# Confidence threshold for license detection
confidence-threshold = 0.8
# List of allowed licenses (SPDX identifiers)
allow = [
    "MIT",
    "Apache-2.0",
    "Apache-2.0 WITH LLVM-exception",
    "BSD-2-Clause",
    "BSD-3-Clause",
    "ISC",
    "Unlicense",
    "Zlib",
    "CC0-1.0",
    "MPL-2.0",
    "Unicode-DFS-2016",
    "BSL-1.0",
]

# Specific crate license exceptions
[[licenses.clarify]]
name = "ring"
expression = "ISC AND MIT AND OpenSSL"
license-files = [{ path = "LICENSE", hash = 0xbd0eed23 }]

# ============================================================================
# BANS - Crate bans and restrictions
# ============================================================================
[bans]
# How to handle multiple versions of the same crate
multiple-versions = "warn"
# How to handle crates with wildcards in their version requirements
wildcards = "allow"
# How to handle build scripts
# "allow" = allow all build scripts
# "deny" = deny all build scripts  
# "warn" = warn about build scripts
highlight = "all"
# Crates that should not be depended upon
deny = [
    # Example: { name = "openssl", wrappers = ["openssl-sys"] },
]
# Crates where we want to skip checking for duplicates
skip = [
    # Allow multiple versions of these crates if needed
    # { name = "syn" },
]
# Crates with known duplicate versions that we're okay with
skip-tree = [
    # { name = "windows-sys", depth = 3 },
]

# ============================================================================
# SOURCES - Supply chain security
# ============================================================================
[sources]
# What to do when a crate is from an unknown source
unknown-registry = "deny"
# What to do when a crate is from a git repository
unknown-git = "warn"
# List of allowed registries
allow-registry = ["https://github.com/rust-lang/crates.io-index"]
# List of allowed git sources
allow-git = []

# ============================================================================
# Additional Configuration
# ============================================================================

# Configure how to handle specific crates
# [sources.allow-org]
# github = ["rust-lang", "rust-lang-nursery"]

